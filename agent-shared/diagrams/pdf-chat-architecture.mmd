graph TB
    %% Title
    title["PDF Chat Appliance Architecture"]
    
    %% User Interface Layer
    subgraph UI["User Interface Layer"]
        Web[Web UI (Flask)]
        CLI[CLI (Typer)]
        API[REST API (FastAPI)]
    end
    
    %% Ingestion Pipeline
    subgraph IP["Ingestion Pipeline"]
        PU[PDF Upload & Validation]
        SC[Semantic Chunking (phi3:cpu)]
        EG[Embedding Generation (all-MiniLM-L6-v2)]
        VS[Vector Storage (Qdrant)]
    end
    
    %% Query Processing
    subgraph QP["Query Processing"]
        QI[Query Input & Preprocessing]
        SS[Similarity Search (Qdrant)]
        CA[Context Assembly & RAG]
    end
    
    %% LLM Layer
    subgraph LLM["LLM Layer"]
        OL[Ollama (Local LLMs)]
        MS[Model Selection (phi3, mistral, llama2)]
        RG[Response Generation]
    end
    
    %% Data Storage
    subgraph DS["Data Storage"]
        QD[Qdrant Vector Database]
        SQL[SQLite (Metadata & Logs)]
        FS[File Storage (PDFs, Configs)]
    end
    
    %% Observability
    subgraph OB["Observability"]
        SL[Structured Logging]
        PM[Performance Metrics]
        HM[Health Monitoring]
    end
    
    %% Configuration
    subgraph CF["Configuration"]
        YC[YAML Configuration]
        EV[Environment Variables]
        AR[Agent Rules (.mdc)]
    end
    
    %% Data Flow Arrows
    %% User Interface to Ingestion
    Web --> PU
    CLI --> PU
    API --> PU
    
    %% User Interface to Query Processing
    Web --> QI
    CLI --> QI
    API --> QI
    
    %% Ingestion to Data Storage
    PU --> QD
    SC --> QD
    EG --> QD
    VS --> QD
    
    %% Query Processing to Data Storage
    QI --> QD
    SS --> QD
    CA --> QD
    
    %% Query Processing to LLM Layer
    CA --> OL
    CA --> MS
    MS --> RG
    
    %% LLM Layer to User Interface
    RG --> Web
    RG --> CLI
    RG --> API
    
    %% Observability Connections (dashed)
    OB -.-> IP
    OB -.-> QP
    OB -.-> LLM
    
    %% Configuration Connections (dashed)
    CF -.-> IP
    CF -.-> QP
    CF -.-> LLM
    
    %% Styling
    classDef ui fill:#dae8fc,stroke:#6c8ebf,stroke-width:2px
    classDef ingestion fill:#fff2cc,stroke:#d6b656,stroke-width:2px
    classDef query fill:#d5e8d4,stroke:#82b366,stroke-width:2px
    classDef llm fill:#e1d5e7,stroke:#9673a6,stroke-width:2px
    classDef storage fill:#f8cecc,stroke:#b85450,stroke-width:2px
    classDef observability fill:#ffe6cc,stroke:#d79b00,stroke-width:2px
    classDef config fill:#f5f5f5,stroke:#666666,stroke-width:2px
    
    class UI,Web,CLI,API ui
    class IP,PU,SC,EG,VS ingestion
    class QP,QI,SS,CA query
    class LLM,OL,MS,RG llm
    class DS,QD,SQL,FS storage
    class OB,SL,PM,HM observability
    class CF,YC,EV,AR config 