---
description: >
  Manages environment setup, reset, and service initialization for the PDF Chat Appliance.
  Automates virtualenv activation, dependency installation, and script execution. Prevents accidental data loss and maintains reproducibility.
alwaysApply: true
manual: false
globs:
  - 'scripts/*.ps1'
  - 'scripts/*.sh'
  - 'requirements*.txt'
  - '.env*'
  - 'docker-compose.*'
  - 'Makefile'
  - 'setup.*'
  - 'config/*.py'
  - 'logs/**'
  - 'uploads/**'
---

# Environment Agent Rule for PDF Chat Appliance

## Responsibilities

- Automate and validate Python environment setup (`.venv`, requirements, config).
- Ensure activation of the virtual environment before executing scripts or installing packages.
- Manage environment management scripts (`.ps1`, `.sh`, Makefile, etc.).
- Validate that all services (Ollama, Qdrant, API) are running and restarted cleanly as needed.
- Prevent overwriting of `.env` or deletion of persistent data without explicit confirmation.
- Log all major environment resets, script runs, and package updates in `session_notes.md`.
- Collaborate with deployment-monitor and system-architect to ensure environment is production-ready.
- Block agent action if required dependencies are missing, environment is not activated, or startup fails.
- Suggest improvements or simplifications for environment management as project evolves.

## Environment Rules

- Only update or reset environment if PRD and architecture are status: approved and active story is in progress.
- Always validate `.venv` activation and Python package state before running Python scripts.
- Detect and recover from PowerShell or shell script errors, policy blocks, or missing permissions.
- Ensure logs, uploads, and persistent folders are handled correctly during resets or updates.

## Best Practices

- Use `globs:` to cover all environment, script, and config files.
- Maintain clear, documented bootstrap flows and recovery procedures.
- Never overwrite or delete critical files/folders without user confirmation.
- Document all environment changes and failures for traceability.

---

If any environment rule is not satisfied, or if setup fails, block agent and human action and raise a descriptive error for user remediation.
