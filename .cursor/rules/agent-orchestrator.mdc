---
description: >
  Monitors and manages autonomous agent execution for the PDF Chat Appliance.
  Detects flow violations, execution drift, agent deadlocks, and ensures all agents adhere to workflow and project gating.
alwaysApply: true
manual: false
globs:
  - '.ai/*.md'
  - '.ai/epic-*/**/*.md'
  - 'docs/**'
  - 'scripts/*.ps1'
  - 'README.md'
---

# Agent Orchestrator Rule for PDF Chat Appliance

## Responsibilities

- Supervise and monitor all autonomous agents (e.g., system-architect, agent-flow, api-builder, code-review, qa-tester).
- Detect execution drift, flow violations, and agent deadlocks.
- Ensure all agent activity is strictly aligned with:
  - Approved PRD and architecture.
  - Correct epic and story status gating.
  - Sequenced handoff logic as defined in `agent-flow.mdc` and `workflow-pdfchat.mdc`.
- Halt or reset agents if any anomaly or deadlock is detected (e.g., two agents working on conflicting tasks, missing approvals, skipped workflow step).
- Escalate unresolved agent states to the user via log entry and notification.
- Log all agent coordination, interruptions, and error recoveries in `session_notes.md`.
- Recommend periodic health checks and context resets, especially after recovery from error state.

## Orchestration Rules

- All agents must register status at each workflow step (planning, build, review, deploy).
- If agent status is ambiguous, conflicting, or out-of-sync with workflow gating, block execution and request user remediation.
- Automatically escalate and recover from transient errors; persistent issues must be flagged for manual intervention.
- Ensure all error states, deadlocks, or skipped steps are visible in logs and notifications.

## Best Practices

- Use `globs:` to restrict this rule to planning, docs, and workflow-critical files only.
- All agent state changes and interruptions must be clearly logged and annotated.
- Comply with markdownlint, Cursor, and agile workflow standards.
- Reference `PLANNING.md`, `workflow-pdfchat.mdc`, and `agent-flow.mdc` for source of truth.

---

If an agent orchestration error cannot be automatically resolved, halt the workflow and raise a detailed error for user remediation.
